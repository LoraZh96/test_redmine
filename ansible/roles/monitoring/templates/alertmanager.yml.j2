{% set telegram_bot_token = lookup('env', 'TELEGRAM_BOT_TOKEN') | default('', true) %}
{% set telegram_chat_id = lookup('env', 'TELEGRAM_CHAT_ID') | default('', true) %}
{% set telegram_enabled = telegram_bot_token | length > 0 and telegram_chat_id | length > 0 %}

global:
  resolve_timeout: 1m

route:
  receiver: '{{ "telegram" if telegram_enabled else "null" }}'
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 3h

receivers:
{% if telegram_enabled %}
  - name: 'telegram'
    telegram_configs:
      - bot_token: "${TELEGRAM_BOT_TOKEN}"
        chat_id: "${TELEGRAM_CHAT_ID}"
        parse_mode: 'Markdown'
        send_resolved: true
        message: |
          {% raw %}
          *{{ .Status | toUpper }}*: {{ .CommonAnnotations.summary }}
          {{ range .Alerts }}
          *Alert:* {{ .Labels.alertname }}
          *Instance:* {{ .Labels.instance }}
          *Severity:* {{ .Labels.severity }}
          *Description:* {{ .Annotations.description }}
          {{ end }}
          {% endraw %}
{% else %}
  - name: 'null'
{% endif %}
